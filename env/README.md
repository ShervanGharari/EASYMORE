# Example of installing EASYMORE in a virtual environment

**âš  ATTENTION:**
We highly recommend before using EASYMORE, the virtual environment is set up properly, and then the examples from the GitHub repository are tested to evaluate the authenticity of the results with what is generated by the EASYMORE development team.

## Mac

The following commands can be executed on a Mac terminal.
First, we need to have `gdal` source files. On Mac, this can be done by:
```brew install gdal```
If you already have installed `gdal`, you can create a virtual env. For this example we create the virtual environment by installing `virtualenv` first:
```
python -m pip install virtualenv
python -m virtualenv easymore-env
```
After the environment is created we can activate this virtual environment and check its information:
```
source easymore-env/bin/activate
```
We can then install easymore from PyPI:
```
python -m pip install easymore
```
Or this can be done from the latest code from easymore GitHub repository:
```
git clone https://github.com/ShervanGharari/EASYMORE.git path/to/easymore
python -m pip install path/to/easymore
```
In order to be able to run the examples with jupyter notebook, we need to install jupyter and ipykernel and link it to the virtual environment.
```
python -m pip install jupyter
python -m pip install ipykernel
python -m ipykernel install --name=easymore-env # Add the new virtual environment to Jupyter
jupyter kernelspec list # list existing Jupyter virtual environments
```
The example can be tested by navigating to the examples folder of the cloned EASYMORE repo
```
cd path/to/easymore/examples
jupyter notebook
```
Make sure the jupyter notebook kernel is the same as your env name.
Another way to run the example is to convert the jupyter notebook to python and simulate them as follow:
```
cd path/to/easymore/examples
jupyter nbconvert *.ipynb --to python # converts all the files to .py
python 00_test_example.py # compare the result with repository
python 01_ERA5_Regular_Lat_Lon.py # compare the result with repository
```
In addition, we have provided an example of a requirements file that is tested with EASYMORE development team for Python 3.11.2 is provided. The users can install all the needed packages before installing EASYMORE by `pip install -r path/to/easymore/env/requirements_mac.txt`.


## Windows

The following commands can be executed on the conda prompt. First, we set the virtual environment with `conda`:
```
conda create --name easymore-env python=3.9 --no-default-packages
```
To activate the virtual environment and update the `pip`:
```
conda activate easymore-env
python -m pip install --upgrade pip
```
Then we install `gdal` from inside the virtual environment:
```
conda install -c conda-forge gdal

```
And then we can install easymore either from PyPI:
```
python -m pip install easymore
```
 or from local repository:
```
git clone https://github.com/ShervanGharari/EASYMORE.git path/to/easymore
python -m pip install path/to/easymore
```
In order to be able to run the examples with jupyter notebook, we need to install jupyter and ipykernel and link it to the virtual environment.
```
python -m pip install jupyter
python -m pip install ipykernel
python -m ipykernel install --name=easymore-env # Add the new virtual environment to Jupyter
jupyter kernelspec list # list existing Jupyter virtual environments
```
The example can be tested by navigating to the examples folder of the cloned EASYMORE repo
```
cd path/to/easymore/examples
jupyter notebook
```
Make sure the jupyter notebook kernel is the same as your env name.
Another way to run the example is to convert the jupyter notebook to Python and simulate them as follows:
```
cd path/to/easymore/examples
jupyter nbconvert *.ipynb --to python # converts all the files to .py
python 00_test_example.py # compare the result with repository
python 01_ERA5_Regular_Lat_Lon.py # compare the result with repository
```
In addition, we have provided an example of a requirements file that is tested with EASYMORE development team for Python 3.9 is provided. The users can install all the needed packages before installing EASYMORE by `pip install -r path/to/easymore/env/requirements_win.txt`.

## Linux

This is an example of the testing of EASYMORE example using the Digital Research Alliance of Canada, formerly known as ComputeCanada, Cluster called Graham and its available modules (this might be subjected to change over constant changes of available module versions):
```
cd
module reset
module purge
deactivate

# load needed modules
module load StdEnv/2020 gcc/9.3.0 openmpi/4.0.3
module load gdal/3.5.1 libspatialindex/1.8.5
module load python/3.8.10 scipy-stack/2022a mpi4py/3.0.3

# remove existing virtual env folder and set up virtual env for easymore
rm -rf ~/easymore-env
virtualenv ~/easymore-env
source ~/easymore-env/bin/activate
pip install --no-index --upgrade pip
pip install --no-index easymore # install from CC wheelhouse, similar to above this can be installed locally or from pypi

# check if the code runs smoothly given the example on the easymore github repo
cd # go to home
rm -rf EASYMORE
git clone https://github.com/ShervanGharari/EASYMORE.git
cd EASYMORE/examples
pip install --no-index jupyter
jupyter nbconvert *.ipynb --to python
python 00_test_example.py # compare the result with repository
python 01_ERA5_Regular_Lat_Lon.py # compare the result with repository
#
```
